<!doctype html>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å–®å­—ç·´ç¿’ï¼ˆæŒ‰å¤©é¸æ“‡ï¼‰</title>
  <style>
    :root { font-family: system-ui, -apple-system, "Noto Sans SC", "Segoe UI", Arial, sans-serif; }
    body { margin: 0; padding: 16px; background: #f7f7fb; color: #111; }
    .wrap { max-width: 1040px; margin: 0 auto; display: grid; gap: 12px; }
    header { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; justify-content: space-between; }
    .title { font-size: 20px; font-weight: 900; display:flex; gap:10px; align-items:center; }
    .card { background: white; border-radius: 16px; padding: 14px; box-shadow: 0 8px 18px rgba(0,0,0,.06); }
    .row { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
    button, select, input {
      border-radius: 12px; border: 1px solid #ddd; padding: 10px 12px; background: #fff; font-size: 15px;
    }
    button { cursor: pointer; }
    button.primary { background: #111; color: #fff; border-color: #111; }
    button:disabled { opacity: .55; cursor: not-allowed; }
    .muted { color: #666; font-size: 13px; }
    .pill { display:inline-flex; align-items:center; gap:8px; padding: 6px 10px; border-radius: 999px; border: 1px solid #ddd; background:#fff; }
    .split { display:grid; gap:12px; grid-template-columns: 1fr; }
    @media (min-width: 920px){ .split { grid-template-columns: 1.25fr .75fr; } }
    .divider { border:0; border-top:1px solid #eee; margin: 12px 0; }

    /* Start Screen */
    .startTitle { font-weight: 900; font-size: 18px; }
    .startBox { display:grid; gap:12px; }
    .bigBtn { padding: 14px 14px; border-radius: 14px; font-weight: 900; }

    /* Flashcard */
    .flashWrap { display:grid; gap:10px; justify-items:center; }
    .flashCard { width: min(560px, 92vw); height: 260px; perspective: 1200px; }
    .flashInner { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform .5s ease; }
    .flashInner.flipped { transform: rotateY(180deg); }
    .face {
      position: absolute; inset: 0; display:grid; place-items:center;
      border-radius: 18px; backface-visibility: hidden; border: 1px solid #eee;
      background: linear-gradient(180deg,#fff,#fafafa);
    }
    .back { transform: rotateY(180deg); }
    .big { font-size: clamp(26px, 4vw, 44px); font-weight: 900; text-align:center; padding: 10px 16px; }
    .small { font-size: 13px; color:#666; text-align:center; }

    /* Test */
    .prompt {
      background: #f3f4ff; border: 1px solid #e6e6ff;
      border-radius: 14px; padding: 12px;
      font-size: 22px; font-weight: 900; text-align:center;
    }
    .choices { display:grid; gap:10px; grid-template-columns: 1fr; margin-top: 12px; }
    @media (min-width: 620px){ .choices { grid-template-columns: 1fr 1fr; } }
    .choiceBtn { padding: 14px 12px; border-radius: 14px; border: 1px solid #ddd; background:#fff; font-weight: 800; text-align:left; }
    .choiceBtn.correct { border-color: #17a34a; background: #e9f8ef; }
    .choiceBtn.wrong { border-color: #dc2626; background: #fdecec; }

    .scoreBox { display:grid; gap:8px; padding:12px; border-radius:14px; background:#0b1220; color:#fff; }
    .scoreBox b { font-size: 22px; }
    .missBox { font-size: 13px; color:#444; line-height: 1.6; }
  </style>
</head>

<body>
<div class="wrap">
  <header>
    <div class="title">ğŸ“š å–®å­—ç·´ç¿’ï¼ˆæŒ‰å¤©é¸æ“‡ï¼‰</div>
    <div class="row" id="topControls" style="display:none;">
      <span class="pill">ç•¶å‰ï¼š<b id="setName"></b></span>

      <span class="pill">æ¨¡å¼ï¼š
        <select id="modeSel">
          <option value="practice">ç·´ç¿’ï¼ˆç¿»å¡ï¼‰</option>
          <option value="test">è‡ªæˆ‘æ¸¬è©¦</option>
        </select>
      </span>

      <span class="pill" id="testTypeWrap" style="display:none;">æ¸¬è©¦ï¼š
        <select id="testTypeSel">
          <option value="en2zh">çœ‹è‹±æ–‡é¸ä¸­æ–‡</option>
          <option value="zh2en">çœ‹ä¸­æ–‡é¸è‹±æ–‡</option>
          <option value="listenSpell">è½éŸ³æ‹¼å­—</option>
        </select>
      </span>

      <button id="shuffleBtn">æ´—ç‰Œ</button>
      <button id="resetBtn">é‡ç½®</button>
      <button id="changeSetBtn">æ›ä¸€å¤©</button>
    </div>
  </header>

  <div class="split">
    <section class="card" id="mainArea"></section>

    <aside class="card" id="sideArea">
      <div class="row" style="justify-content: space-between;">
        <b>ç»Ÿè®¡</b>
        <span class="muted" id="countInfo"></span>
      </div>

      <div class="scoreBox" style="margin-top:10px;">
        <div class="muted" style="color:#cbd5e1;">ç•¶å‰åˆ†æ•¸</div>
        <div><b id="scoreText">0</b> <span class="muted" style="color:#cbd5e1;">/ <span id="totalText">0</span></span></div>
      </div>

      <hr class="divider">
      <div class="muted">éŒ¯é¡Œè¨˜éŒ„ï¼ˆæœ€è¿‘10æ¢ï¼‰</div>
      <div id="missBox" class="missBox"></div>

      <hr class="divider">
      <div class="muted">
        è½éŸ³æ‰¹å­—ï¼šä½¿ç”¨ç€è¦½å™¨èªéŸ³ï¼ˆTTSï¼‰ã€‚å¦‚æœæ²’è²éŸ³ï¼Œè«‹æª¢æŸ¥éœéŸ³/åª’é«”éŸ³é‡ï¼›éƒ¨åˆ†ç€è¦½å™¨éœ€è¦å…ˆé»æŒ‰éˆ•æ‰å…è¨±æ’­æ”¾ã€‚
      </div>
    </aside>
  </div>
</div>

<script>
/** =========================
 * è€å¸«å›ºå®šæä¾›ï¼šæŒ‰â€œå¤©/æ–‡ç« â€åˆ†çµ„
 * ä½ åªéœ€è¦åœ¨ VOCAB_SETS è£¡æ–°å¢æ›´å¤šå¤©çš„å–®å­—å³å¯
 * ========================= */
const VOCAB_SETS = [
  {
    name: "Day 1ï¼ˆ20260121-1ï¼‰",
    words: [
      { en: "tadpole", zh: "èŒèšª" },
      { en: "goose geese", zh: "éµ" },
      { en: "pen", zh: "åŸå­ç­†ï¼›åœˆï¼ˆã„ã„©ã„¢Ë‹ï¼‰" },
      { en: "leave left", zh: "ç•™ä¸‹ï¼›é›¢é–‹" },
      { en: "lock the door", zh: "é–é–€" },
    ],
  },
  {
    name: "Day 2ï¼ˆ20260121-2ï¼‰",
    words: [
      { en: "chase chased", zh: "è¿½è¶•" },
      { en: "a group of", zh: "ä¸€ç¾¤" },
      { en: "bite bit bitten", zh: "å•„ï¼›å’¬" },
      { en: "stick insect", zh: "ç«¹ç¯€èŸ²" },
      { en: "stick", zh: "æ£å­ã€æ£’å­" },
    ],
  },
  {
    name: "Day 3ï¼ˆ20260121-3ï¼‰",
    words: [
      { en: "insect", zh: "æ˜†èŸ²" },
      { en: "spit spat spat", zh: "åï¼ˆå£æ°´ï¼‰" },
      { en: "dodge ball", zh: "èº²é¿çƒ" },
      { en: "light", zh: "è¼•çš„ï¼›æ·ºè‰²çš„ï¼›æ˜äº®çš„ï¼›ç‡ˆ" },
      { en: "heavy", zh: "é‡çš„" },
    ],
  },
  {
    name: "Day 4ï¼ˆ20260121-4ï¼‰",
    words: [
      { en: "rise rose risen", zh: "ä¸Šå‡" },
      { en: "squirrel", zh: "æ¾é¼ " },
      { en: "owl", zh: "è²“é ­é·¹" },
      { en: "woodpecker", zh: "å•„æœ¨é³¥" },
      { en: "go went gone", zh: "å»" },
    ],
  },
  {
    name: "Day 5ï¼ˆ20260121-5ï¼‰",
    words: [
      { en: "last", zh: "æœ€å¾Œçš„" },
      { en: "feel felt", zh: "æ„Ÿè¦º" },
      { en: "peaceful", zh: "å’Œå¹³çš„" },
      { en: "story", zh: "æ•…äº‹" },
      { en: "at the beginning", zh: "åœ¨ä¸€é–‹å§‹" },
      { en: "at the end", zh: "åœ¨æœ€å¾Œï¼›åœ¨çµå°¾" },
    ],
  },
{
    name: "Day 6ï¼ˆ20260128-1ï¼‰",
    words: [
{ en: "arrive", zh: "æŠµé”" },
{ en: "win", zh: "è´" },
{ en: "take first place", zh: "è´å¾—ç¬¬ä¸€å" },
{ en: "build a nest", zh: "ç¯‰å·¢" },
{ en: "nest", zh: "å·¢" },
    ],
  },

  {
    name: "Day 7ï¼ˆ20260128-2ï¼‰",
    words: [
{ en: "wall", zh: "ç‰†å£" },
{ en: "run", zh: "è·‘" },
{ en: "happily", zh: "é–‹å¿ƒåœ°" },
{ en: "collect", zh: "è’é›†" },
{ en: "mouth", zh: "å˜´å·´" },
    ],
  },
  {
    name: "Day 8ï¼ˆ20260128-3ï¼‰",
    words: [
{ en: "pet", zh: "å¯µç‰©" },
{ en: "cafe", zh: "å’–å•¡å»³" },
{ en: "restaurant", zh: "é¤å»³" },
{ en: "fly", zh: "é£›" },
{ en: "convenience store", zh: "ä¾¿åˆ©å•†åº—" },
{ en: "tea egg", zh: "èŒ¶è‘‰è›‹" },
    ],
  },
  

  
];

/* ===== å·¥å…· ===== */
const $ = (id) => document.getElementById(id);

function shuffle(arr){
  const a = arr.slice();
  for (let i = a.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}
function sample(arr, n){
  return shuffle(arr).slice(0, n);
}
function speak(text){
  try{
    if (!("speechSynthesis" in window)) return;
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "en-US";
    u.rate = 0.95;
    window.speechSynthesis.speak(u);
  }catch(e){}
}

/* ===== ç‹€æ…‹ ===== */
let currentSetIndex = -1;
let words = [];
let order = [];
let idx = 0;

let mode = "practice";
let testType = "en2zh"; // en2zh | zh2en | listenSpell

let score = 0;
let total = 0;
let misses = []; // {q, right, picked}

/* ===== å³å´çµ±è¨ˆ ===== */
function updateSide(){
  $("scoreText").textContent = String(score);
  $("totalText").textContent = String(total);
  $("countInfo").textContent = currentSetIndex >= 0 ? `å…± ${words.length} ä¸ªå•è¯` : "";
  const m = misses.slice(-10).reverse();
  $("missBox").innerHTML = m.length
    ? m.map(x => `â€¢ <b>${escapeHtml(x.q)}</b> â†’ âœ… ${escapeHtml(x.right)}ã€€ï¼ˆä½ é€‰ï¼š${escapeHtml(x.picked)}ï¼‰`).join("<br>")
    : `<span class="muted">æš‚æ— </span>`;
}
function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, m => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
  }[m]));
}

/* ===== Start Screenï¼ˆé¸ Dayï¼‰ ===== */
function renderStart(){
  $("topControls").style.display = "none";
  $("mainArea").innerHTML = `
    <div class="startBox">
      <div class="startTitle">å…ˆé¸æ“‡ä»Šå¤©è¦ç·´å“ªä¸€å¤©</div>
      <div class="row">
        <select id="startSetSel" style="min-width:260px;"></select>
        <button class="primary bigBtn" id="startBtn">é–‹å§‹</button>
      </div>
      <div class="muted"></div>
    </div>
  `;
  const sel = $("startSetSel");
  VOCAB_SETS.forEach((s, i) => {
    const opt = document.createElement("option");
    opt.value = String(i);
    opt.textContent = s.name;
    sel.appendChild(opt);
  });
  $("startBtn").onclick = () => {
    const i = Number(sel.value);
    loadSet(i);
  };
  updateSide();
}

/* ===== ä¸Šæ–¹æ§åˆ¶åˆ—ï¼šé¡¯ç¤º/éš±è—ã€Œæ¸¬è©¦æ–¹å¼ã€ ===== */
function updateTopTestTypeUI(){
  const wrap = $("testTypeWrap");
  if (!wrap) return;

  if (currentSetIndex >= 0 && ($("modeSel").value === "test")) {
    wrap.style.display = "inline-flex";
  } else {
    wrap.style.display = "none";
  }
}

/* ===== è¼‰å…¥æŸä¸€å¤© ===== */
function loadSet(i){
  currentSetIndex = i;
  words = VOCAB_SETS[i].words.slice();
  order = shuffle(words.map((_, k) => k));
  idx = 0;
  score = 0;
  misses = [];
  total = 0;

  $("setName").textContent = VOCAB_SETS[i].name;
  $("topControls").style.display = "flex";

  mode = $("modeSel").value || "practice";
  updateTopTestTypeUI();
  render();
  updateSide();
}

/* ===== ç·´ç¿’ï¼ˆç¿»å¡ï¼‰ ===== */
function renderPractice(){
  const w = words[order[idx]];
  $("mainArea").innerHTML = `
    <div class="flashWrap">
      <div class="muted">é»å¡ç‰‡ç¿»é¢ï¼›æˆ–ç”¨ä¸‹æ–¹æŒ‰éˆ•</div>

      <div class="flashCard">
        <div class="flashInner" id="flashInner">
          <div class="face front">
            <div>
              <div class="big">${escapeHtml(w.en)}</div>
              <div class="small">ï¼ˆé»ä¸€ä¸‹çœ‹ä¸­æ–‡ï¼‰</div>
            </div>
          </div>
          <div class="face back">
            <div>
              <div class="big">${escapeHtml(w.zh)}</div>
              <div class="small">ï¼ˆé»ä¸€ä¸‹å›è‹±æ–‡ï¼‰</div>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <button id="ttsBtn">ğŸ”Š ç™¼éŸ³</button>
        <button id="flipBtn">ç¿»é¢</button>
        <button id="prevBtn">ä¸Šä¸€ä¸ª</button>
        <button class="primary" id="nextBtn">ä¸‹ä¸€ä¸ª</button>
      </div>

      <div class="muted">é€²åº¦ï¼š${idx + 1} / ${order.length}</div>
    </div>
  `;

  const inner = $("flashInner");
  const flip = () => inner.classList.toggle("flipped");
  inner.onclick = flip;
  $("flipBtn").onclick = flip;
  $("ttsBtn").onclick = () => speak(w.en);

  $("prevBtn").onclick = () => {
    idx = (idx - 1 + order.length) % order.length;
    renderPractice();
  };
  $("nextBtn").onclick = () => {
    idx = (idx + 1) % order.length;
    renderPractice();
  };
}

/* ===== æ¸¬é©—é¡Œï¼šå…©ç¨®é¸æ“‡é¡Œ ===== */
function makeTestQuestion(){
  const w = words[order[idx]];

  if (testType === "en2zh") {
    const correct = w.zh;
    const wrongPool = words.filter(x => x.zh !== correct).map(x => x.zh);
    const wrongs = sample(wrongPool, Math.min(3, wrongPool.length));
    const options = shuffle([correct, ...wrongs]);
    return { q: w.en, correct, options, tts: w.en };
  }

  if (testType === "zh2en") {
    const correct = w.en;
    const wrongPool = words.filter(x => x.en !== correct).map(x => x.en);
    const wrongs = sample(wrongPool, Math.min(3, wrongPool.length));
    const options = shuffle([correct, ...wrongs]);
    return { q: w.zh, correct, options, tts: w.en };
  }

  return null;
}

/* ===== è½éŸ³æ‹¼å­— ===== */
function normalizeSpell(s){
  return String(s).trim().toLowerCase().replace(/\s+/g, " ");
}

function renderListenSpell(){
  const w = words[order[idx]];
  const answer = w.en;

  $("mainArea").innerHTML = `
    <div>
      <div class="row" style="justify-content:space-between;">
        <div class="muted">è½éŸ³æ‹¼å­—ï¼ˆè¼¸å…¥è‹±æ–‡ï¼‰</div>
        <div class="muted">é€²åº¦ï¼š${idx + 1} / ${order.length}</div>
      </div>

      <div class="prompt">ğŸ”Š è«‹è½éŸ³ï¼Œè¼¸å…¥è‹±æ–‡</div>

      <div class="row" style="margin-top:10px;">
        <button id="ttsBtn">ğŸ”Š æ’­æ”¾</button>
        <button id="revealBtn">é¡¯ç¤ºç­”æ¡ˆ</button>
        <button id="skipBtn">è·³é</button>
      </div>

      <div class="row" style="margin-top:12px;">
        <input id="spellInput" placeholder="Type here..." style="flex:1; min-width:240px;" />
        <button class="primary" id="checkBtn">æäº¤</button>
      </div>

      <div id="spellFeedback" class="muted" style="margin-top:10px;"></div>
      <div class="muted" style="margin-top:10px;">æç¤ºï¼šå¤§å°å¯«ä¸å½±éŸ¿ï¼›å¤šé¤˜ç©ºæ ¼æœƒè‡ªå‹•å¿½ç•¥</div>
    </div>
  `;

  const input = $("spellInput");
  const feedback = $("spellFeedback");

  $("ttsBtn").onclick = () => speak(answer);

  $("skipBtn").onclick = () => {
    idx = (idx + 1) % order.length;
    renderListenSpell();
  };

  $("revealBtn").onclick = () => {
    feedback.innerHTML = `ç­”æ¡ˆï¼š<b>${escapeHtml(answer)}</b>ï¼ˆ${escapeHtml(w.zh)}ï¼‰`;
  };

  function grade(){
    const user = normalizeSpell(input.value);
    const right = normalizeSpell(answer);

    total += 1;

    if (user && user === right) {
      score += 1;
      feedback.innerHTML = `âœ… æ­£ç¢ºï¼ç­”æ¡ˆæ˜¯ï¼š<b>${escapeHtml(answer)}</b>`;
    } else {
      feedback.innerHTML = `âŒ ä¸å°å–”ï½ æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š<b>${escapeHtml(answer)}</b>`;
      misses.push({ q: `ğŸ”Šï¼ˆè½éŸ³ï¼‰`, right: answer, picked: input.value || "(ç©ºç™½)" });
    }

    updateSide();

    setTimeout(() => {
      idx = (idx + 1) % order.length;
      renderListenSpell();
    }, 700);
  }

  $("checkBtn").onclick = grade;
  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") grade();
  });

  input.focus();
}

/* ===== æ¸¬é©—æ¸²æŸ“ï¼ˆåŒ…å«ä¸‰ç¨®æ–¹å¼ï¼‰ ===== */
function renderTest(){
  // 1) è½éŸ³æ‹¼å­—
  if (testType === "listenSpell") {
    renderListenSpell();
    return;
  }

  // 2) é¸æ“‡é¡Œ
  const q = makeTestQuestion();
  if (!q) return;

  const titleText = (testType === "zh2en") ? "é¸å‡ºæ­£ç¢ºè‹±æ–‡" : "é¸å‡ºæ­£ç¢ºä¸­æ–‡";

  $("mainArea").innerHTML = `
    <div>
      <div class="row" style="justify-content:space-between;">
        <div class="muted">${titleText}</div>
        <div class="muted">é€²åº¦ï¼š${idx + 1} / ${order.length}</div>
      </div>

      <div class="prompt">${escapeHtml(q.q)}</div>

<div class="row" style="margin-top:10px;">
  ${testType === "en2zh" ? `<button id="ttsBtn">ğŸ”Š ç™¼éŸ³</button>` : ``}
  <button id="skipBtn">è·³é</button>
</div>


      <div class="choices" id="choices"></div>

      <div class="muted" style="margin-top:10px;">æç¤ºï¼šç­”é¡Œå¾Œæœƒè‡ªå‹•é€²å…¥ä¸‹ä¸€é¡Œ</div>
    </div>
  `;

if (testType === "en2zh") {
  $("ttsBtn").onclick = () => speak(q.tts);
}

  const box = $("choices");
  q.options.forEach(opt => {
    const b = document.createElement("button");
    b.className = "choiceBtn";
    b.textContent = opt;

    b.onclick = () => {
      total += 1;

      const isRight = opt === q.correct;
      if (isRight) {
        score += 1;
        b.classList.add("correct");
      } else {
        b.classList.add("wrong");
        misses.push({ q: q.q, right: q.correct, picked: opt });
      }

      [...box.querySelectorAll("button")].forEach(btn => {
        if (btn.textContent === q.correct) btn.classList.add("correct");
        btn.disabled = true;
      });

      updateSide();

      setTimeout(() => {
        idx = (idx + 1) % order.length;
        renderTest();
      }, 550);
    };

    box.appendChild(b);
  });

  $("skipBtn").onclick = () => {
    idx = (idx + 1) % order.length;
    renderTest();
  };
}

/* ===== å…¥å£ render ===== */
function render(){
  if (currentSetIndex < 0) return renderStart();

  mode = $("modeSel").value || mode;

  updateTopTestTypeUI();
  if ($("testTypeSel")) testType = $("testTypeSel").value;

  if (mode === "practice") renderPractice();
  else renderTest();

  updateSide();
}

/* ===== ä¸Šæ–¹æ§åˆ¶åˆ— ===== */
$("modeSel").addEventListener("change", () => {
  updateTopTestTypeUI();
  render();
});

$("testTypeSel").addEventListener("change", () => {
  testType = $("testTypeSel").value;
  render();
});

$("shuffleBtn").onclick = () => {
  if (currentSetIndex < 0) return;
  order = shuffle(words.map((_, k) => k));
  idx = 0;
  render();
};

$("resetBtn").onclick = () => {
  if (currentSetIndex < 0) return;
  idx = 0;
  score = 0;
  total = 0;
  misses = [];
  render();
};

$("changeSetBtn").onclick = () => {
  currentSetIndex = -1;
  words = [];
  order = [];
  idx = 0;
  score = 0;
  total = 0;
  misses = [];
  renderStart();
};

/* ===== åˆå§‹åŒ– ===== */
renderStart();
</script>
</body>
</html>

